function sqr=scale_nonneg(scafs,sval,IU,PU,IApB,PApB,IAB,PAB,IBuf,PBuf,choice)%% Usage: sqr=scale_nonneg(scafs,sval,IU,PU,IApB,PApB,IAB,PAB,IBuf,PBuf,IqD,index,choice,Y);%% Inputs: 	scafs		scalling coefficients %			sval		s-values%			IU  		Scattering intensity unlabelled sample%			PU  		Initial probability distribution unlabelled sample%			IApB  		Scattering intensity sum of single-labelled samples%           PApB  		Initial probability distribution sum of single-labelled samples%			IAB 		Scattering intensity double-labelled sample%           PAB  		Initial probability distribution double-labelled sample%			IBuf  		Scattering intensity distribution double-labelled sample%			PBuf  		Initial probability distribution buffer%			choice 		Method for minimization%% Outputs:	sqr 		Value to be minimized%%% choice =1: I*S^2% choice =2: I*S% choice =3: no P term  IA+IB% choice =4: I*S% choice =5: I*S2% choice =6: I*S2, no P, IA and IB seperate% n1 sqr% n3 Pdelta% n4 jug1% n5 jug2n1=1;n3=1;n4=0;n5=0;Idel=IAB+scafs(1)*IU-scafs(2)*IApB+scafs(3)*IBuf; % Initial interference pattern with starting parametersPdel=PAB+scafs(1)*PU-scafs(2)*PApB+scafs(3)*PBuf; % Initial probability distribution with starting parametersjug1=1;jug2=1;Inorm=sum((IU.*sval.*sval).^2);Pnorm=sum(PU.^2);switch choice        case 1       % disp('plos one way');        sqr=sum((Idel.*sval.*sval).^2)/Inorm+sum(Pdel(Pdel<0).^2)/Pnorm*n3;        sqr=(sqr^n1)*jug1^n4*jug2^n5;    case 2        % disp('xs way');        sqr=sum((Idel.*sval).^2)/Inorm+sum(Pdel(Pdel<0).^2)/Pnorm*n3;        sqr=(sqr^n1)*jug1^n4*jug2^n5;    case 3       %  disp('xs way S1.5');        sqr=sum((Idel.*sval).^2.*sval)/Inorm+sum(Pdel(Pdel<0).^2)/Pnorm*n3;        sqr=(sqr^n1)*jug1^n4*jug2^n5;    case 4        % disp('xs way S1.5, adjust');        sval2=sval;        index2=find(sval>0.06);        sval2(index2)=sval(index2(1));        sval2=sval2./sval(index2(1));        sqr=sum((Idel.*sval).^2.*sval2)/Inorm+sum(Pdel(Pdel<0).^2)/Pnorm*n3;        sqr=(sqr^n1)*jug1^n4*jug2^n5;    case 5        % disp('xs way S1.5, adjust2');        sval2=sval;        index2=find(sval>0.06);        sval2(index2)=sval(1);        sval2=sval2./sval(index2(1));        sqr=sum((Idel.*sval).^2.*sval2)/Inorm+sum(Pdel(Pdel<0).^2)/Pnorm*n3;        sqr=(sqr^n1)*jug1^n4*jug2^n5;            case 6       %  disp('Pdelta only');        sqr=sum(Pdel(Pdel<0).^2)/Pnorm*n3;        sqr=(sqr^n1)*jug1^n4*jug2^n5;    case 7       %  disp('Pdelta only');        sqr=sum((Idel(sval>0.06).*sval(sval>0.06)).^2)/Inorm;        sqr=(sqr^n1)*jug1^n4*jug2^n5;end