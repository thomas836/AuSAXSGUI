function [Idelta, parameter, fval]=gen_Idelta_nonneg(sval,IU,IA,IB,IAB,IBuf,choice)%% Usage: Idelta=gen_Idelta(sval,IU,IA,IB,IAB,IBuf,PDI);%% Inputs:	sval		s-values%			IU  		Scattering intensity unlabelled sample%			IA  		Scattering intensity of single-labelled sample A%			IB  		Scattering intensity of single-labelled sample B%			IAB 		Scattering intensity double-labelled sample%			IBuf  		Initial probability distribution double-labelled sample%			choice 		Initial probability distribution buffer%% Outputs:	sqr 		Value to be minimized%%%choice =1: I*S^2%choice =2: I*S%choice =3: no P term  IA+IB%choice =4: I*S%choice =5: I*S2%choice =6: I*S2, no P, IA and IB seperateDBIN=5;Dval=1:DBIN:200;IqD=gen_IqD(ones(length(sval))',sval,Dval);IApB=IA+IB;PU=lsqnonneg(IqD,IU);PApB=lsqnonneg(IqD,IApB);PAB=lsqnonneg(IqD,IAB);PBuf=lsqnonneg(IqD,IBuf);quality=@(scafs) scale_nonneg(scafs,sval,IU,PU,IApB,PApB,IAB,PAB,IBuf,PBuf,choice); % Function for optimizationinit=[1; 1; 0]; % Starting scalling coefficients[opt,fval]=fminsearch(quality,init); % Optimizing the interference pattern using option choiceIdelta=IAB+opt(1)*IU-opt(2)*IApB+opt(3)*IBuf; % Final optimized interference patternparameter=[opt(1),opt(2),opt(3)]; % Final optimized scalling coefficients    end